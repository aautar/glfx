var glfx = (function (exports) {
  'use strict';

  var EPSILON=1e-6,ARRAY_TYPE="undefined"==typeof Float32Array?Array:Float32Array,RANDOM=Math.random;Math.hypot||(Math.hypot=function(){for(var e=0,r=arguments.length;r--;)e+=arguments[r]*arguments[r];return Math.sqrt(e)});function create(){var e=new ARRAY_TYPE(16);return ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function clone(e){var r=new ARRAY_TYPE(16);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function copy(e,r){return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e}function fromValues(e,r,t,a,s,n,i,o,l,d,f,g,m,u,c,R){var T=new ARRAY_TYPE(16);return T[0]=e,T[1]=r,T[2]=t,T[3]=a,T[4]=s,T[5]=n,T[6]=i,T[7]=o,T[8]=l,T[9]=d,T[10]=f,T[11]=g,T[12]=m,T[13]=u,T[14]=c,T[15]=R,T}function set(e,r,t,a,s,n,i,o,l,d,f,g,m,u,c,R,T){return e[0]=r,e[1]=t,e[2]=a,e[3]=s,e[4]=n,e[5]=i,e[6]=o,e[7]=l,e[8]=d,e[9]=f,e[10]=g,e[11]=m,e[12]=u,e[13]=c,e[14]=R,e[15]=T,e}function identity(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function transpose(e,r){if(e===r){var t=r[1],a=r[2],s=r[3],n=r[6],i=r[7],o=r[11];e[1]=r[4],e[2]=r[8],e[3]=r[12],e[4]=t,e[6]=r[9],e[7]=r[13],e[8]=a,e[9]=n,e[11]=r[14],e[12]=s,e[13]=i,e[14]=o;}else e[0]=r[0],e[1]=r[4],e[2]=r[8],e[3]=r[12],e[4]=r[1],e[5]=r[5],e[6]=r[9],e[7]=r[13],e[8]=r[2],e[9]=r[6],e[10]=r[10],e[11]=r[14],e[12]=r[3],e[13]=r[7],e[14]=r[11],e[15]=r[15];return e}function invert(e,r){var t=r[0],a=r[1],s=r[2],n=r[3],i=r[4],o=r[5],l=r[6],d=r[7],f=r[8],g=r[9],m=r[10],u=r[11],c=r[12],R=r[13],T=r[14],E=r[15],b=t*o-a*i,x=t*l-s*i,p=t*d-n*i,h=a*l-s*o,_=a*d-n*o,A=s*d-n*l,B=f*R-g*c,F=f*T-m*c,P=f*E-u*c,U=g*T-m*R,D=g*E-u*R,w=m*E-u*T,M=b*w-x*D+p*U+h*P-_*F+A*B;return M?(M=1/M,e[0]=(o*w-l*D+d*U)*M,e[1]=(s*D-a*w-n*U)*M,e[2]=(R*A-T*_+E*h)*M,e[3]=(m*_-g*A-u*h)*M,e[4]=(l*P-i*w-d*F)*M,e[5]=(t*w-s*P+n*F)*M,e[6]=(T*p-c*A-E*x)*M,e[7]=(f*A-m*p+u*x)*M,e[8]=(i*D-o*P+d*B)*M,e[9]=(a*P-t*D-n*B)*M,e[10]=(c*_-R*p+E*b)*M,e[11]=(g*p-f*_-u*b)*M,e[12]=(o*F-i*U-l*B)*M,e[13]=(t*U-a*F+s*B)*M,e[14]=(R*x-c*h-T*b)*M,e[15]=(f*h-g*x+m*b)*M,e):null}function adjoint(e,r){var t=r[0],a=r[1],s=r[2],n=r[3],i=r[4],o=r[5],l=r[6],d=r[7],f=r[8],g=r[9],m=r[10],u=r[11],c=r[12],R=r[13],T=r[14],E=r[15];return e[0]=o*(m*E-u*T)-g*(l*E-d*T)+R*(l*u-d*m),e[1]=-(a*(m*E-u*T)-g*(s*E-n*T)+R*(s*u-n*m)),e[2]=a*(l*E-d*T)-o*(s*E-n*T)+R*(s*d-n*l),e[3]=-(a*(l*u-d*m)-o*(s*u-n*m)+g*(s*d-n*l)),e[4]=-(i*(m*E-u*T)-f*(l*E-d*T)+c*(l*u-d*m)),e[5]=t*(m*E-u*T)-f*(s*E-n*T)+c*(s*u-n*m),e[6]=-(t*(l*E-d*T)-i*(s*E-n*T)+c*(s*d-n*l)),e[7]=t*(l*u-d*m)-i*(s*u-n*m)+f*(s*d-n*l),e[8]=i*(g*E-u*R)-f*(o*E-d*R)+c*(o*u-d*g),e[9]=-(t*(g*E-u*R)-f*(a*E-n*R)+c*(a*u-n*g)),e[10]=t*(o*E-d*R)-i*(a*E-n*R)+c*(a*d-n*o),e[11]=-(t*(o*u-d*g)-i*(a*u-n*g)+f*(a*d-n*o)),e[12]=-(i*(g*T-m*R)-f*(o*T-l*R)+c*(o*m-l*g)),e[13]=t*(g*T-m*R)-f*(a*T-s*R)+c*(a*m-s*g),e[14]=-(t*(o*T-l*R)-i*(a*T-s*R)+c*(a*l-s*o)),e[15]=t*(o*m-l*g)-i*(a*m-s*g)+f*(a*l-s*o),e}function determinant(e){var r=e[0],t=e[1],a=e[2],s=e[3],n=e[4],i=e[5],o=e[6],l=e[7],d=e[8],f=e[9],g=e[10],m=e[11],u=e[12],c=e[13],R=e[14],T=e[15],E=r*i-t*n,b=r*o-a*n,x=r*l-s*n,p=t*o-a*i,h=t*l-s*i,_=a*l-s*o,A=d*c-f*u,B=d*R-g*u,F=d*T-m*u,P=f*R-g*c,U=f*T-m*c,D=g*T-m*R;return E*D-b*U+x*P+p*F-h*B+_*A}function multiply(e,r,t){var a=r[0],s=r[1],n=r[2],i=r[3],o=r[4],l=r[5],d=r[6],f=r[7],g=r[8],m=r[9],u=r[10],c=r[11],R=r[12],T=r[13],E=r[14],b=r[15],x=t[0],p=t[1],h=t[2],_=t[3];return e[0]=x*a+p*o+h*g+_*R,e[1]=x*s+p*l+h*m+_*T,e[2]=x*n+p*d+h*u+_*E,e[3]=x*i+p*f+h*c+_*b,x=t[4],p=t[5],h=t[6],_=t[7],e[4]=x*a+p*o+h*g+_*R,e[5]=x*s+p*l+h*m+_*T,e[6]=x*n+p*d+h*u+_*E,e[7]=x*i+p*f+h*c+_*b,x=t[8],p=t[9],h=t[10],_=t[11],e[8]=x*a+p*o+h*g+_*R,e[9]=x*s+p*l+h*m+_*T,e[10]=x*n+p*d+h*u+_*E,e[11]=x*i+p*f+h*c+_*b,x=t[12],p=t[13],h=t[14],_=t[15],e[12]=x*a+p*o+h*g+_*R,e[13]=x*s+p*l+h*m+_*T,e[14]=x*n+p*d+h*u+_*E,e[15]=x*i+p*f+h*c+_*b,e}function translate(e,r,t){var a,s,n,i,o,l,d,f,g,m,u,c,R=t[0],T=t[1],E=t[2];return r===e?(e[12]=r[0]*R+r[4]*T+r[8]*E+r[12],e[13]=r[1]*R+r[5]*T+r[9]*E+r[13],e[14]=r[2]*R+r[6]*T+r[10]*E+r[14],e[15]=r[3]*R+r[7]*T+r[11]*E+r[15]):(a=r[0],s=r[1],n=r[2],i=r[3],o=r[4],l=r[5],d=r[6],f=r[7],g=r[8],m=r[9],u=r[10],c=r[11],e[0]=a,e[1]=s,e[2]=n,e[3]=i,e[4]=o,e[5]=l,e[6]=d,e[7]=f,e[8]=g,e[9]=m,e[10]=u,e[11]=c,e[12]=a*R+o*T+g*E+r[12],e[13]=s*R+l*T+m*E+r[13],e[14]=n*R+d*T+u*E+r[14],e[15]=i*R+f*T+c*E+r[15]),e}function scale(e,r,t){var a=t[0],s=t[1],n=t[2];return e[0]=r[0]*a,e[1]=r[1]*a,e[2]=r[2]*a,e[3]=r[3]*a,e[4]=r[4]*s,e[5]=r[5]*s,e[6]=r[6]*s,e[7]=r[7]*s,e[8]=r[8]*n,e[9]=r[9]*n,e[10]=r[10]*n,e[11]=r[11]*n,e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e}function rotate(e,r,a,n){var i,o,l,d,f,g,m,u,R,T,E,b,p,h,_,A,B,F,P,U,D,w,M,v,S=n[0],I=n[1],C=n[2],L=Math.hypot(S,I,C);return L<EPSILON?null:(L=1/L,S*=L,I*=L,C*=L,i=Math.sin(a),o=Math.cos(a),l=1-o,d=r[0],f=r[1],g=r[2],m=r[3],u=r[4],R=r[5],T=r[6],E=r[7],b=r[8],p=r[9],h=r[10],_=r[11],A=S*S*l+o,B=I*S*l+C*i,F=C*S*l-I*i,P=S*I*l-C*i,U=I*I*l+o,D=C*I*l+S*i,w=S*C*l+I*i,M=I*C*l-S*i,v=C*C*l+o,e[0]=d*A+u*B+b*F,e[1]=f*A+R*B+p*F,e[2]=g*A+T*B+h*F,e[3]=m*A+E*B+_*F,e[4]=d*P+u*U+b*D,e[5]=f*P+R*U+p*D,e[6]=g*P+T*U+h*D,e[7]=m*P+E*U+_*D,e[8]=d*w+u*M+b*v,e[9]=f*w+R*M+p*v,e[10]=g*w+T*M+h*v,e[11]=m*w+E*M+_*v,r!==e&&(e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e)}function rotateX(e,r,t){var a=Math.sin(t),s=Math.cos(t),n=r[4],i=r[5],o=r[6],l=r[7],d=r[8],f=r[9],g=r[10],m=r[11];return r!==e&&(e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e[4]=n*s+d*a,e[5]=i*s+f*a,e[6]=o*s+g*a,e[7]=l*s+m*a,e[8]=d*s-n*a,e[9]=f*s-i*a,e[10]=g*s-o*a,e[11]=m*s-l*a,e}function rotateY(e,r,t){var a=Math.sin(t),s=Math.cos(t),n=r[0],i=r[1],o=r[2],l=r[3],d=r[8],f=r[9],g=r[10],m=r[11];return r!==e&&(e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e[0]=n*s-d*a,e[1]=i*s-f*a,e[2]=o*s-g*a,e[3]=l*s-m*a,e[8]=n*a+d*s,e[9]=i*a+f*s,e[10]=o*a+g*s,e[11]=l*a+m*s,e}function rotateZ(e,r,t){var a=Math.sin(t),s=Math.cos(t),n=r[0],i=r[1],o=r[2],l=r[3],d=r[4],f=r[5],g=r[6],m=r[7];return r!==e&&(e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e[0]=n*s+d*a,e[1]=i*s+f*a,e[2]=o*s+g*a,e[3]=l*s+m*a,e[4]=d*s-n*a,e[5]=f*s-i*a,e[6]=g*s-o*a,e[7]=m*s-l*a,e}function fromTranslation(e,r){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function fromScaling(e,r){return e[0]=r[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=r[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function fromRotation(e,r,a){var n,i,o,l=a[0],d=a[1],f=a[2],g=Math.hypot(l,d,f);return g<EPSILON?null:(g=1/g,l*=g,d*=g,f*=g,n=Math.sin(r),i=Math.cos(r),o=1-i,e[0]=l*l*o+i,e[1]=d*l*o+f*n,e[2]=f*l*o-d*n,e[3]=0,e[4]=l*d*o-f*n,e[5]=d*d*o+i,e[6]=f*d*o+l*n,e[7]=0,e[8]=l*f*o+d*n,e[9]=d*f*o-l*n,e[10]=f*f*o+i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function fromXRotation(e,r){var t=Math.sin(r),a=Math.cos(r);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=t,e[7]=0,e[8]=0,e[9]=-t,e[10]=a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function fromYRotation(e,r){var t=Math.sin(r),a=Math.cos(r);return e[0]=a,e[1]=0,e[2]=-t,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=t,e[9]=0,e[10]=a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function fromZRotation(e,r){var t=Math.sin(r),a=Math.cos(r);return e[0]=a,e[1]=t,e[2]=0,e[3]=0,e[4]=-t,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function fromRotationTranslation(e,r,t){var a=r[0],s=r[1],n=r[2],i=r[3],o=a+a,l=s+s,d=n+n,f=a*o,g=a*l,m=a*d,u=s*l,c=s*d,R=n*d,T=i*o,E=i*l,b=i*d;return e[0]=1-(u+R),e[1]=g+b,e[2]=m-E,e[3]=0,e[4]=g-b,e[5]=1-(f+R),e[6]=c+T,e[7]=0,e[8]=m+E,e[9]=c-T,e[10]=1-(f+u),e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function fromQuat2(e,r){var t=new ARRAY_TYPE(3),a=-r[0],s=-r[1],n=-r[2],i=r[3],o=r[4],l=r[5],d=r[6],f=r[7],g=a*a+s*s+n*n+i*i;return 0<g?(t[0]=2*(o*i+f*a+l*n-d*s)/g,t[1]=2*(l*i+f*s+d*a-o*n)/g,t[2]=2*(d*i+f*n+o*s-l*a)/g):(t[0]=2*(o*i+f*a+l*n-d*s),t[1]=2*(l*i+f*s+d*a-o*n),t[2]=2*(d*i+f*n+o*s-l*a)),fromRotationTranslation(e,r,t),e}function getTranslation(e,r){return e[0]=r[12],e[1]=r[13],e[2]=r[14],e}function getScaling(e,r){var t=r[0],a=r[1],s=r[2],n=r[4],i=r[5],o=r[6],l=r[8],d=r[9],f=r[10];return e[0]=Math.hypot(t,a,s),e[1]=Math.hypot(n,i,o),e[2]=Math.hypot(l,d,f),e}function getRotation(e,r){var t=new ARRAY_TYPE(3);getScaling(t,r);var a=1/t[0],s=1/t[1],n=1/t[2],i=r[0]*a,o=r[1]*s,l=r[2]*n,d=r[4]*a,f=r[5]*s,g=r[6]*n,m=r[8]*a,u=r[9]*s,c=r[10]*n,R=i+f+c,T=0;return 0<R?(T=2*Math.sqrt(R+1),e[3]=.25*T,e[0]=(g-u)/T,e[1]=(m-l)/T,e[2]=(o-d)/T):i>f&&i>c?(T=2*Math.sqrt(1+i-f-c),e[3]=(g-u)/T,e[0]=.25*T,e[1]=(o+d)/T,e[2]=(m+l)/T):f>c?(T=2*Math.sqrt(1+f-i-c),e[3]=(m-l)/T,e[0]=(o+d)/T,e[1]=.25*T,e[2]=(g+u)/T):(T=2*Math.sqrt(1+c-i-f),e[3]=(o-d)/T,e[0]=(m+l)/T,e[1]=(g+u)/T,e[2]=.25*T),e}function fromRotationTranslationScale(e,r,t,a){var s=r[0],n=r[1],i=r[2],o=r[3],l=s+s,d=n+n,f=i+i,g=s*l,m=s*d,u=s*f,c=n*d,R=n*f,T=i*f,E=o*l,b=o*d,x=o*f,p=a[0],h=a[1],_=a[2];return e[0]=(1-(c+T))*p,e[1]=(m+x)*p,e[2]=(u-b)*p,e[3]=0,e[4]=(m-x)*h,e[5]=(1-(g+T))*h,e[6]=(R+E)*h,e[7]=0,e[8]=(u+b)*_,e[9]=(R-E)*_,e[10]=(1-(g+c))*_,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function fromRotationTranslationScaleOrigin(e,r,t,a,s){var n=r[0],i=r[1],o=r[2],l=r[3],d=n+n,f=i+i,g=o+o,m=n*d,u=n*f,c=n*g,R=i*f,T=i*g,E=o*g,b=l*d,x=l*f,p=l*g,h=a[0],_=a[1],A=a[2],B=s[0],F=s[1],P=s[2],U=(1-(R+E))*h,D=(u+p)*h,w=(c-x)*h,M=(u-p)*_,v=(1-(m+E))*_,S=(T+b)*_,I=(c+x)*A,C=(T-b)*A,L=(1-(m+R))*A;return e[0]=U,e[1]=D,e[2]=w,e[3]=0,e[4]=M,e[5]=v,e[6]=S,e[7]=0,e[8]=I,e[9]=C,e[10]=L,e[11]=0,e[12]=t[0]+B-(U*B+M*F+I*P),e[13]=t[1]+F-(D*B+v*F+C*P),e[14]=t[2]+P-(w*B+S*F+L*P),e[15]=1,e}function fromQuat(e,r){var t=r[0],a=r[1],s=r[2],n=r[3],i=t+t,o=a+a,l=s+s,d=t*i,f=a*i,g=a*o,m=s*i,u=s*o,c=s*l,R=n*i,T=n*o,E=n*l;return e[0]=1-g-c,e[1]=f+E,e[2]=m-T,e[3]=0,e[4]=f-E,e[5]=1-d-c,e[6]=u+R,e[7]=0,e[8]=m+T,e[9]=u-R,e[10]=1-d-g,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function frustum(e,r,t,a,s,n,i){var o=1/(t-r),l=1/(s-a),d=1/(n-i);return e[0]=2*n*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*n*l,e[6]=0,e[7]=0,e[8]=(t+r)*o,e[9]=(s+a)*l,e[10]=(i+n)*d,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*(i*n)*d,e[15]=0,e}function perspective(e,r,t,a,s){var n,i=1/Math.tan(r/2);return e[0]=i/t,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=s&&s!==1/0?(n=1/(a-s),e[10]=(s+a)*n,e[14]=2*s*a*n):(e[10]=-1,e[14]=-2*a),e}function perspectiveFromFieldOfView(e,r,t,a){var s=Math.tan(r.upDegrees*Math.PI/180),n=Math.tan(r.downDegrees*Math.PI/180),i=Math.tan(r.leftDegrees*Math.PI/180),o=Math.tan(r.rightDegrees*Math.PI/180),l=2/(i+o),d=2/(s+n);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=d,e[6]=0,e[7]=0,e[8]=-(.5*((i-o)*l)),e[9]=.5*((s-n)*d),e[10]=a/(t-a),e[11]=-1,e[12]=0,e[13]=0,e[14]=a*t/(t-a),e[15]=0,e}function ortho(e,r,t,a,s,n,i){var o=1/(r-t),l=1/(a-s),d=1/(n-i);return e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*d,e[11]=0,e[12]=(r+t)*o,e[13]=(s+a)*l,e[14]=(i+n)*d,e[15]=1,e}function lookAt(e,r,t,a){var s,n,i,o,l,d,f,g,m,u,c=r[0],R=r[1],T=r[2],E=a[0],b=a[1],x=a[2],p=t[0],h=t[1],_=t[2];return Math.abs(c-p)<EPSILON&&Math.abs(R-h)<EPSILON&&Math.abs(T-_)<EPSILON?identity(e):(f=c-p,g=R-h,m=T-_,u=1/Math.hypot(f,g,m),f*=u,g*=u,m*=u,s=b*m-x*g,n=x*f-E*m,i=E*g-b*f,u=Math.hypot(s,n,i),u?(u=1/u,s*=u,n*=u,i*=u):(s=0,n=0,i=0),o=g*i-m*n,l=m*s-f*i,d=f*n-g*s,u=Math.hypot(o,l,d),u?(u=1/u,o*=u,l*=u,d*=u):(o=0,l=0,d=0),e[0]=s,e[1]=o,e[2]=f,e[3]=0,e[4]=n,e[5]=l,e[6]=g,e[7]=0,e[8]=i,e[9]=d,e[10]=m,e[11]=0,e[12]=-(s*c+n*R+i*T),e[13]=-(o*c+l*R+d*T),e[14]=-(f*c+g*R+m*T),e[15]=1,e)}function targetTo(e,r,t,a){var s=r[0],n=r[1],i=r[2],o=a[0],l=a[1],d=a[2],f=s-t[0],g=n-t[1],m=i-t[2],u=f*f+g*g+m*m;0<u&&(u=1/Math.sqrt(u),f*=u,g*=u,m*=u);var c=l*m-d*g,R=d*f-o*m,T=o*g-l*f;return u=c*c+R*R+T*T,0<u&&(u=1/Math.sqrt(u),c*=u,R*=u,T*=u),e[0]=c,e[1]=R,e[2]=T,e[3]=0,e[4]=g*T-m*R,e[5]=m*c-f*T,e[6]=f*R-g*c,e[7]=0,e[8]=f,e[9]=g,e[10]=m,e[11]=0,e[12]=s,e[13]=n,e[14]=i,e[15]=1,e}function str(e){return "mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function frob(e){return Math.hypot(e[0],e[1],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function add(e,r,t){return e[0]=r[0]+t[0],e[1]=r[1]+t[1],e[2]=r[2]+t[2],e[3]=r[3]+t[3],e[4]=r[4]+t[4],e[5]=r[5]+t[5],e[6]=r[6]+t[6],e[7]=r[7]+t[7],e[8]=r[8]+t[8],e[9]=r[9]+t[9],e[10]=r[10]+t[10],e[11]=r[11]+t[11],e[12]=r[12]+t[12],e[13]=r[13]+t[13],e[14]=r[14]+t[14],e[15]=r[15]+t[15],e}function subtract(e,r,t){return e[0]=r[0]-t[0],e[1]=r[1]-t[1],e[2]=r[2]-t[2],e[3]=r[3]-t[3],e[4]=r[4]-t[4],e[5]=r[5]-t[5],e[6]=r[6]-t[6],e[7]=r[7]-t[7],e[8]=r[8]-t[8],e[9]=r[9]-t[9],e[10]=r[10]-t[10],e[11]=r[11]-t[11],e[12]=r[12]-t[12],e[13]=r[13]-t[13],e[14]=r[14]-t[14],e[15]=r[15]-t[15],e}function multiplyScalar(e,r,t){return e[0]=r[0]*t,e[1]=r[1]*t,e[2]=r[2]*t,e[3]=r[3]*t,e[4]=r[4]*t,e[5]=r[5]*t,e[6]=r[6]*t,e[7]=r[7]*t,e[8]=r[8]*t,e[9]=r[9]*t,e[10]=r[10]*t,e[11]=r[11]*t,e[12]=r[12]*t,e[13]=r[13]*t,e[14]=r[14]*t,e[15]=r[15]*t,e}function multiplyScalarAndAdd(e,r,t,a){return e[0]=r[0]+t[0]*a,e[1]=r[1]+t[1]*a,e[2]=r[2]+t[2]*a,e[3]=r[3]+t[3]*a,e[4]=r[4]+t[4]*a,e[5]=r[5]+t[5]*a,e[6]=r[6]+t[6]*a,e[7]=r[7]+t[7]*a,e[8]=r[8]+t[8]*a,e[9]=r[9]+t[9]*a,e[10]=r[10]+t[10]*a,e[11]=r[11]+t[11]*a,e[12]=r[12]+t[12]*a,e[13]=r[13]+t[13]*a,e[14]=r[14]+t[14]*a,e[15]=r[15]+t[15]*a,e}function exactEquals(e,r){return e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2]&&e[3]===r[3]&&e[4]===r[4]&&e[5]===r[5]&&e[6]===r[6]&&e[7]===r[7]&&e[8]===r[8]&&e[9]===r[9]&&e[10]===r[10]&&e[11]===r[11]&&e[12]===r[12]&&e[13]===r[13]&&e[14]===r[14]&&e[15]===r[15]}function equals(e,r){var t=e[0],a=e[1],s=e[2],n=e[3],i=e[4],o=e[5],l=e[6],d=e[7],f=e[8],g=e[9],m=e[10],u=e[11],c=e[12],R=e[13],T=e[14],E=e[15],b=r[0],x=r[1],p=r[2],h=r[3],_=r[4],A=r[5],B=r[6],F=r[7],P=r[8],U=r[9],D=r[10],w=r[11],M=r[12],v=r[13],S=r[14],I=r[15];return Math.abs(t-b)<=EPSILON*Math.max(1,Math.abs(t),Math.abs(b))&&Math.abs(a-x)<=EPSILON*Math.max(1,Math.abs(a),Math.abs(x))&&Math.abs(s-p)<=EPSILON*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(n-h)<=EPSILON*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(i-_)<=EPSILON*Math.max(1,Math.abs(i),Math.abs(_))&&Math.abs(o-A)<=EPSILON*Math.max(1,Math.abs(o),Math.abs(A))&&Math.abs(l-B)<=EPSILON*Math.max(1,Math.abs(l),Math.abs(B))&&Math.abs(d-F)<=EPSILON*Math.max(1,Math.abs(d),Math.abs(F))&&Math.abs(f-P)<=EPSILON*Math.max(1,Math.abs(f),Math.abs(P))&&Math.abs(g-U)<=EPSILON*Math.max(1,Math.abs(g),Math.abs(U))&&Math.abs(m-D)<=EPSILON*Math.max(1,Math.abs(m),Math.abs(D))&&Math.abs(u-w)<=EPSILON*Math.max(1,Math.abs(u),Math.abs(w))&&Math.abs(c-M)<=EPSILON*Math.max(1,Math.abs(c),Math.abs(M))&&Math.abs(R-v)<=EPSILON*Math.max(1,Math.abs(R),Math.abs(v))&&Math.abs(T-S)<=EPSILON*Math.max(1,Math.abs(T),Math.abs(S))&&Math.abs(E-I)<=EPSILON*Math.max(1,Math.abs(E),Math.abs(I))}var mul=multiply,sub=subtract,mat4=Object.freeze({__proto__:null,create:create,clone:clone,copy:copy,fromValues:fromValues,set:set,identity:identity,transpose:transpose,invert:invert,adjoint:adjoint,determinant:determinant,multiply:multiply,translate:translate,scale:scale,rotate:rotate,rotateX:rotateX,rotateY:rotateY,rotateZ:rotateZ,fromTranslation:fromTranslation,fromScaling:fromScaling,fromRotation:fromRotation,fromXRotation:fromXRotation,fromYRotation:fromYRotation,fromZRotation:fromZRotation,fromRotationTranslation:fromRotationTranslation,fromQuat2:fromQuat2,getTranslation:getTranslation,getScaling:getScaling,getRotation:getRotation,fromRotationTranslationScale:fromRotationTranslationScale,fromRotationTranslationScaleOrigin:fromRotationTranslationScaleOrigin,fromQuat:fromQuat,frustum:frustum,perspective:perspective,perspectiveFromFieldOfView:perspectiveFromFieldOfView,ortho:ortho,lookAt:lookAt,targetTo:targetTo,str:str,frob:frob,add:add,subtract:subtract,multiplyScalar:multiplyScalar,multiplyScalarAndAdd:multiplyScalarAndAdd,exactEquals:exactEquals,equals:equals,mul:mul,sub:sub});function create$1(){var e=new ARRAY_TYPE(3);return ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function clone$1(e){var r=new ARRAY_TYPE(3);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r}function length(e){var r=e[0],t=e[1],a=e[2];return Math.hypot(r,t,a)}function fromValues$1(e,r,t){var a=new ARRAY_TYPE(3);return a[0]=e,a[1]=r,a[2]=t,a}function copy$1(e,r){return e[0]=r[0],e[1]=r[1],e[2]=r[2],e}function set$1(e,r,t,a){return e[0]=r,e[1]=t,e[2]=a,e}function add$1(e,r,t){return e[0]=r[0]+t[0],e[1]=r[1]+t[1],e[2]=r[2]+t[2],e}function subtract$1(e,r,t){return e[0]=r[0]-t[0],e[1]=r[1]-t[1],e[2]=r[2]-t[2],e}function multiply$1(e,r,t){return e[0]=r[0]*t[0],e[1]=r[1]*t[1],e[2]=r[2]*t[2],e}function divide(e,r,t){return e[0]=r[0]/t[0],e[1]=r[1]/t[1],e[2]=r[2]/t[2],e}function ceil(e,r){return e[0]=Math.ceil(r[0]),e[1]=Math.ceil(r[1]),e[2]=Math.ceil(r[2]),e}function floor(e,r){return e[0]=Math.floor(r[0]),e[1]=Math.floor(r[1]),e[2]=Math.floor(r[2]),e}function min(e,r,t){return e[0]=Math.min(r[0],t[0]),e[1]=Math.min(r[1],t[1]),e[2]=Math.min(r[2],t[2]),e}function max(e,r,t){return e[0]=Math.max(r[0],t[0]),e[1]=Math.max(r[1],t[1]),e[2]=Math.max(r[2],t[2]),e}function round(e,r){return e[0]=Math.round(r[0]),e[1]=Math.round(r[1]),e[2]=Math.round(r[2]),e}function scale$1(e,r,t){return e[0]=r[0]*t,e[1]=r[1]*t,e[2]=r[2]*t,e}function scaleAndAdd(e,r,t,a){return e[0]=r[0]+t[0]*a,e[1]=r[1]+t[1]*a,e[2]=r[2]+t[2]*a,e}function distance(e,r){var t=r[0]-e[0],a=r[1]-e[1],s=r[2]-e[2];return Math.hypot(t,a,s)}function squaredDistance(e,r){var t=r[0]-e[0],a=r[1]-e[1],s=r[2]-e[2];return t*t+a*a+s*s}function squaredLength(e){var r=e[0],t=e[1],a=e[2];return r*r+t*t+a*a}function negate(e,r){return e[0]=-r[0],e[1]=-r[1],e[2]=-r[2],e}function inverse(e,r){return e[0]=1/r[0],e[1]=1/r[1],e[2]=1/r[2],e}function normalize(e,r){var t=r[0],a=r[1],s=r[2],n=t*t+a*a+s*s;return 0<n&&(n=1/Math.sqrt(n)),e[0]=r[0]*n,e[1]=r[1]*n,e[2]=r[2]*n,e}function dot(e,r){return e[0]*r[0]+e[1]*r[1]+e[2]*r[2]}function cross(e,r,t){var a=r[0],s=r[1],n=r[2],i=t[0],o=t[1],l=t[2];return e[0]=s*l-n*o,e[1]=n*i-a*l,e[2]=a*o-s*i,e}function lerp(e,r,a,s){var t=r[0],n=r[1],i=r[2];return e[0]=t+s*(a[0]-t),e[1]=n+s*(a[1]-n),e[2]=i+s*(a[2]-i),e}function hermite(e,r,a,s,n,i){var t=i*i,o=t*(2*i-3)+1,l=t*(i-2)+i,d=t*(i-1),f=t*(3-2*i);return e[0]=r[0]*o+a[0]*l+s[0]*d+n[0]*f,e[1]=r[1]*o+a[1]*l+s[1]*d+n[1]*f,e[2]=r[2]*o+a[2]*l+s[2]*d+n[2]*f,e}function bezier(e,r,a,s,n,i){var t=1-i,o=t*t,l=i*i,d=o*t,f=3*i*o,g=3*l*t,m=l*i;return e[0]=r[0]*d+a[0]*f+s[0]*g+n[0]*m,e[1]=r[1]*d+a[1]*f+s[1]*g+n[1]*m,e[2]=r[2]*d+a[2]*f+s[2]*g+n[2]*m,e}function random(e,t){t=t||1;var a=2*RANDOM()*Math.PI,r=2*RANDOM()-1,s=Math.sqrt(1-r*r)*t;return e[0]=Math.cos(a)*s,e[1]=Math.sin(a)*s,e[2]=r*t,e}function transformMat4(e,r,t){var a=r[0],s=r[1],n=r[2],i=t[3]*a+t[7]*s+t[11]*n+t[15];return i=i||1,e[0]=(t[0]*a+t[4]*s+t[8]*n+t[12])/i,e[1]=(t[1]*a+t[5]*s+t[9]*n+t[13])/i,e[2]=(t[2]*a+t[6]*s+t[10]*n+t[14])/i,e}function transformMat3(e,r,t){var a=r[0],s=r[1],n=r[2];return e[0]=a*t[0]+s*t[3]+n*t[6],e[1]=a*t[1]+s*t[4]+n*t[7],e[2]=a*t[2]+s*t[5]+n*t[8],e}function transformQuat(e,r,t){var a=t[0],s=t[1],n=t[2],i=t[3],o=r[0],l=r[1],d=r[2],f=s*d-n*l,g=n*o-a*d,m=a*l-s*o,u=s*m-n*g,c=n*f-a*m,R=a*g-s*f,T=2*i;return f*=T,g*=T,m*=T,u*=2,c*=2,R*=2,e[0]=o+f+u,e[1]=l+g+c,e[2]=d+m+R,e}function rotateX$1(e,t,a,s){var n=[],i=[];return n[0]=t[0]-a[0],n[1]=t[1]-a[1],n[2]=t[2]-a[2],i[0]=n[0],i[1]=n[1]*Math.cos(s)-n[2]*Math.sin(s),i[2]=n[1]*Math.sin(s)+n[2]*Math.cos(s),e[0]=i[0]+a[0],e[1]=i[1]+a[1],e[2]=i[2]+a[2],e}function rotateY$1(e,t,a,s){var n=[],i=[];return n[0]=t[0]-a[0],n[1]=t[1]-a[1],n[2]=t[2]-a[2],i[0]=n[2]*Math.sin(s)+n[0]*Math.cos(s),i[1]=n[1],i[2]=n[2]*Math.cos(s)-n[0]*Math.sin(s),e[0]=i[0]+a[0],e[1]=i[1]+a[1],e[2]=i[2]+a[2],e}function rotateZ$1(e,t,a,s){var n=[],i=[];return n[0]=t[0]-a[0],n[1]=t[1]-a[1],n[2]=t[2]-a[2],i[0]=n[0]*Math.cos(s)-n[1]*Math.sin(s),i[1]=n[0]*Math.sin(s)+n[1]*Math.cos(s),i[2]=n[2],e[0]=i[0]+a[0],e[1]=i[1]+a[1],e[2]=i[2]+a[2],e}function angle(e,r){var t=fromValues$1(e[0],e[1],e[2]),a=fromValues$1(r[0],r[1],r[2]);normalize(t,t),normalize(a,a);var s=dot(t,a);return 1<s?0:-1>s?Math.PI:Math.acos(s)}function zero(e){return e[0]=0,e[1]=0,e[2]=0,e}function str$1(e){return "vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function exactEquals$1(e,r){return e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2]}function equals$1(e,r){var t=e[0],a=e[1],s=e[2],n=r[0],i=r[1],o=r[2];return Math.abs(t-n)<=EPSILON*Math.max(1,Math.abs(t),Math.abs(n))&&Math.abs(a-i)<=EPSILON*Math.max(1,Math.abs(a),Math.abs(i))&&Math.abs(s-o)<=EPSILON*Math.max(1,Math.abs(s),Math.abs(o))}var sub$1=subtract$1,mul$1=multiply$1,div=divide,dist=distance,sqrDist=squaredDistance,len=length,sqrLen=squaredLength,forEach=function(){var e=create$1();return function(r,t,a,s,n,o){var d,f;for(t||(t=3),a||(a=0),f=s?Math.min(s*t+a,r.length):r.length,d=a;d<f;d+=t)e[0]=r[d],e[1]=r[d+1],e[2]=r[d+2],n(e,e,o),r[d]=e[0],r[d+1]=e[1],r[d+2]=e[2];return r}}(),vec3=Object.freeze({__proto__:null,create:create$1,clone:clone$1,length:length,fromValues:fromValues$1,copy:copy$1,set:set$1,add:add$1,subtract:subtract$1,multiply:multiply$1,divide:divide,ceil:ceil,floor:floor,min:min,max:max,round:round,scale:scale$1,scaleAndAdd:scaleAndAdd,distance:distance,squaredDistance:squaredDistance,squaredLength:squaredLength,negate:negate,inverse:inverse,normalize:normalize,dot:dot,cross:cross,lerp:lerp,hermite:hermite,bezier:bezier,random:random,transformMat4:transformMat4,transformMat3:transformMat3,transformQuat:transformQuat,rotateX:rotateX$1,rotateY:rotateY$1,rotateZ:rotateZ$1,angle:angle,zero:zero,str:str$1,exactEquals:exactEquals$1,equals:equals$1,sub:sub$1,mul:mul$1,div:div,dist:dist,sqrDist:sqrDist,len:len,sqrLen:sqrLen,forEach:forEach}),Model=function Model(){this.vertexBuffer=null,this.indexBuffer=null,this.texcoordBuffer=null,this.normalBuffer=null;};Model.createScreenQuadStrip=function(e){var r={verts:[-1,1,0,-1,-1,0,1,-1,0,1,1,0],normals:[],indices:[0,1,3,2],texcoords:[0,1,0,0,1,0,1,1]};return Model.fromJson(e,r)},Model.fromJson=function(e,r){var t=new Model;return t.vertexBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,t.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array(r.verts),e.STATIC_DRAW),t.vertexBuffer.itemSize=3,t.vertexBuffer.numItems=r.verts.length/3,t.indexBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array(r.indices),e.STATIC_DRAW),t.indexBuffer.itemSize=1,t.indexBuffer.numItems=r.indices.length,0<r.texcoords.length&&(t.texcoordBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,t.texcoordBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array(r.texcoords),e.STATIC_DRAW),t.texcoordBuffer.itemSize=2,t.texcoordBuffer.numItems=r.texcoords.length/2),0<r.normals.length&&(t.normalBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,t.normalBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array(r.normals),e.STATIC_DRAW),t.normalBuffer.itemSize=3,t.normalBuffer.numItems=r.normals/3),t};var glfx={};glfx.version="0.3.1",glfx.echo=function(e){"undefined"!=typeof console.log&&console.log(e);},glfx.gl=null,glfx.rttprog=null,glfx.devicePixelRatio=window.devicePixelRatio||1,glfx.assetRef=0,glfx.onAssetsLoaded=function(){},glfx.onSceneRender=function(){},glfx.whenAssetsLoaded=function(e){"undefined"!=typeof e&&(0===glfx.assetRef?e():glfx.onAssetsLoaded=e);},glfx.incAssetRef=function(){glfx.assetRef++,0===glfx.assetRef&&(glfx.onAssetsLoaded(),glfx.onAssetsLoaded=function(){});},glfx.decAssetRef=function(){glfx.assetRef--;},glfx.shaders={},glfx.shaders.buffer=[],glfx.shaders.load=function(e,r,t,a){return new Promise(function(s,n){glfx.decAssetRef();var i=new XMLHttpRequest;i.onreadystatechange=function(){if(4==i.readyState&&200==i.status){var n=i.responseText,o=glfx.gl.createShader(t);glfx.gl.shaderSource(o,n),glfx.gl.compileShader(o),glfx.gl.getShaderParameter(o,glfx.gl.COMPILE_STATUS)||(glfx.echo("Failed to compile shader: "+e),o=null),"undefined"!=typeof a&&a(o),glfx.shaders.buffer[r]=o,glfx.incAssetRef(),s(o);}},i.open("GET",e,!0),i.send();})},glfx.shaders.createProgram=function(e,r){for(var t=glfx.gl.createProgram(),a=0;a<e.length;a++)glfx.gl.attachShader(t,e[a]);return (glfx.gl.linkProgram(t),!glfx.gl.getProgramParameter(t,glfx.gl.LINK_STATUS))?(glfx.echo("Could not create shader program, failed to link program."),null):(r(t),t)},glfx.textures={},glfx.textures.buffer=[],glfx.textures.load=function(e,r){glfx.decAssetRef(),glfx.textures.buffer[r]=glfx.gl.createTexture();var t=glfx.textures.buffer[r];t.image=new Image,t.image.onload=function(){var e=glfx.textures.buffer[r];glfx.gl.bindTexture(glfx.gl.TEXTURE_2D,e),glfx.gl.pixelStorei(glfx.gl.UNPACK_FLIP_Y_WEBGL,!0),glfx.gl.texImage2D(glfx.gl.TEXTURE_2D,0,glfx.gl.RGBA,glfx.gl.RGBA,glfx.gl.UNSIGNED_BYTE,e.image),glfx.gl.texParameteri(glfx.gl.TEXTURE_2D,glfx.gl.TEXTURE_MAG_FILTER,glfx.gl.LINEAR),glfx.gl.texParameteri(glfx.gl.TEXTURE_2D,glfx.gl.TEXTURE_MIN_FILTER,glfx.gl.LINEAR),glfx.gl.texParameteri(glfx.gl.TEXTURE_2D,glfx.gl.TEXTURE_WRAP_S,glfx.gl.CLAMP_TO_EDGE),glfx.gl.texParameteri(glfx.gl.TEXTURE_2D,glfx.gl.TEXTURE_WRAP_T,glfx.gl.CLAMP_TO_EDGE),glfx.gl.bindTexture(glfx.gl.TEXTURE_2D,null),glfx.incAssetRef();},t.image.src=e;},glfx.models={},glfx.models.buffer=[],glfx.models.jsonParser=function(e){var r=JSON.parse(e);return Model.fromJson(glfx.gl,r)},glfx.models.load=function(e,r,t,a){glfx.decAssetRef();var s=new XMLHttpRequest;s.onreadystatechange=function(){if(4==s.readyState&&200==s.status){var e=t(s.responseText);glfx.models.buffer[r]=e,"undefined"!=typeof a&&a(e),glfx.incAssetRef();}},s.open("GET",e,!0),s.send();},glfx.scene={},glfx.scene.ptime=0,glfx.scene.matCamera=null,glfx.scene.matModelView=null,glfx.scene.matPerspective=null,glfx.scene.graph=[],glfx.scene.rttTexture=null,glfx.scene.rttFramebuffer=null,glfx.scene.rttDepthBuffer=null,glfx.scene.onPostProcessPreDraw=function(){},glfx.scene.worldObject=function(e,r){this.base=e,this.shprog=r,this.position=create$1(),this.rotation=create$1(),this.scale=clone$1([1,1,1]),this.update=function(){},this.render=function(){};},glfx.scene.setPostProcessShaderProgram=function(e){glfx.rttprog=e;},glfx.scene.addWorldObject=function(e){glfx.scene.graph.push(e);},glfx.setFOV=function(e){perspective(glfx.scene.matPerspective,e,glfx.gl.viewportWidth/glfx.gl.viewportHeight,.1,1e3);},glfx.setClearColor=function(e){glfx.gl.clearColor(e[0],e[1],e[2],e[3]);},glfx.initRTTFrameBuffer=function(e,r){var t=glfx.gl.createFramebuffer();return glfx.gl.bindFramebuffer(glfx.gl.FRAMEBUFFER,t),t.width=e,t.height=r,t},glfx.initRTTTexture=function(e){var r=glfx.gl.createTexture();return glfx.gl.bindTexture(glfx.gl.TEXTURE_2D,r),glfx.gl.texParameteri(glfx.gl.TEXTURE_2D,glfx.gl.TEXTURE_MAG_FILTER,glfx.gl.LINEAR),glfx.gl.texParameteri(glfx.gl.TEXTURE_2D,glfx.gl.TEXTURE_MIN_FILTER,glfx.gl.LINEAR),glfx.gl.texParameteri(glfx.gl.TEXTURE_2D,glfx.gl.TEXTURE_WRAP_S,glfx.gl.CLAMP_TO_EDGE),glfx.gl.texParameteri(glfx.gl.TEXTURE_2D,glfx.gl.TEXTURE_WRAP_T,glfx.gl.CLAMP_TO_EDGE),glfx.gl.texImage2D(glfx.gl.TEXTURE_2D,0,glfx.gl.RGBA,e.width,e.height,0,glfx.gl.RGBA,glfx.gl.UNSIGNED_BYTE,null),glfx.gl.bindTexture(glfx.gl.TEXTURE_2D,null),r},glfx.initRTTDepthBuffer=function(e){var r=glfx.gl.createRenderbuffer();return glfx.gl.bindRenderbuffer(glfx.gl.RENDERBUFFER,r),glfx.gl.renderbufferStorage(glfx.gl.RENDERBUFFER,glfx.gl.DEPTH_COMPONENT16,e.width,e.height),r},glfx.init=function(e,r,t,a){if(glfx.gl=e.getContext("experimental-webgl",{antialias:!0}),!glfx.gl)return glfx.echo("No webGL support."),!1;e.style.width=r+"px",e.style.height=t+"px";var s=r*glfx.devicePixelRatio,n=t*glfx.devicePixelRatio;return e.setAttribute("width",s),e.setAttribute("height",n),glfx.gl.viewportWidth=s,glfx.gl.viewportHeight=n,glfx.setClearColor([1,1,1,1]),glfx.gl.enable(glfx.gl.DEPTH_TEST),glfx.scene.matPerspective=create(),glfx.scene.matModelView=create(),glfx.scene.matCamera=create(),glfx.setFOV(1.57079633),glfx.scene.rttFramebuffer=glfx.initRTTFrameBuffer(glfx.gl.viewportWidth,glfx.gl.viewportHeight),glfx.scene.rttTexture=glfx.initRTTTexture(glfx.scene.rttFramebuffer),glfx.scene.rttDepthBuffer=glfx.initRTTDepthBuffer(glfx.scene.rttFramebuffer),glfx.gl.framebufferTexture2D(glfx.gl.FRAMEBUFFER,glfx.gl.COLOR_ATTACHMENT0,glfx.gl.TEXTURE_2D,glfx.scene.rttTexture,0),glfx.gl.framebufferRenderbuffer(glfx.gl.FRAMEBUFFER,glfx.gl.DEPTH_ATTACHMENT,glfx.gl.RENDERBUFFER,glfx.scene.rttDepthBuffer),glfx.models.buffer.rttquad=Model.createScreenQuadStrip(glfx.gl),glfx.gl.bindTexture(glfx.gl.TEXTURE_2D,null),glfx.gl.bindRenderbuffer(glfx.gl.RENDERBUFFER,null),glfx.gl.bindFramebuffer(glfx.gl.FRAMEBUFFER,null),"undefined"!=typeof a&&a(),glfx.render(0),!0},glfx.resetCamera=function(){glfx.scene.matCamera=create();},glfx.translateCamera=function(e){translate(glfx.scene.matCamera,glfx.scene.matCamera,e);},glfx.rotateCamera=function(e,r){rotate(glfx.scene.matCamera,glfx.scene.matCamera,e,r);},glfx.renderToFrameBuffer=function(e,r){glfx.gl.bindFramebuffer(glfx.gl.FRAMEBUFFER,e),glfx.gl.viewport(0,0,glfx.gl.viewportWidth,glfx.gl.viewportHeight),glfx.gl.clear(glfx.gl.COLOR_BUFFER_BIT|glfx.gl.DEPTH_BUFFER_BIT);for(var t=0;t<glfx.scene.graph.length;t++){if(glfx.scene.matModelView=create(),multiply(glfx.scene.matModelView,glfx.scene.matModelView,glfx.scene.matCamera),glfx.scene.graph[t].update(r,glfx.scene.graph[t]),glfx.scene.graph[t].matTransform)multiply(glfx.scene.matModelView,glfx.scene.matModelView,glfx.scene.graph[t].matTransform);else{var a=glfx.scene.graph[t].position,s=glfx.scene.graph[t].rotation,n=glfx.scene.graph[t].scale;scale(glfx.scene.matModelView,glfx.scene.matModelView,n),translate(glfx.scene.matModelView,glfx.scene.matModelView,a),rotate(glfx.scene.matModelView,glfx.scene.matModelView,s[0],[1,0,0]),rotate(glfx.scene.matModelView,glfx.scene.matModelView,s[1],[0,1,0]),rotate(glfx.scene.matModelView,glfx.scene.matModelView,s[2],[0,0,1]);}glfx.gl.useProgram(glfx.scene.graph[t].shprog),glfx.scene.graph[t].render(r,glfx.scene.graph[t],glfx.scene.matModelView,glfx.scene.matPerspective);}},glfx.render=function(e){if(requestAnimationFrame(glfx.render),!(0>glfx.assetRef)){var r=0;0<glfx.scene.ptime&&(r=e-glfx.scene.ptime),glfx.scene.ptime=e,null===glfx.rttprog?glfx.renderToFrameBuffer(null,r):(glfx.renderToFrameBuffer(glfx.scene.rttFramebuffer,r),glfx.renderViewportQuad(glfx.scene.rttTexture,glfx.rttprog,r)),glfx.onSceneRender(r);}},glfx.renderViewportQuad=function(e,r,t){if(null===r)return glfx.echo("glfx.renderViewportQuad failed, _shaderProgram is null"),!1;if(null===e)return glfx.echo("glfx.renderViewportQuad failed, _texture is null"),!1;glfx.gl.bindFramebuffer(glfx.gl.FRAMEBUFFER,null),glfx.gl.viewport(0,0,glfx.gl.viewportWidth,glfx.gl.viewportHeight),glfx.gl.clear(glfx.gl.COLOR_BUFFER_BIT|glfx.gl.DEPTH_BUFFER_BIT);var a=glfx.models.buffer.rttquad,s=create();ortho(s,-1,1,-1,1,.1,-100);var n=create();return lookAt(n,clone$1([0,0,0]),clone$1([0,0,-1]),clone$1([0,1,0])),glfx.gl.useProgram(r),glfx.gl.activeTexture(glfx.gl.TEXTURE0),glfx.gl.bindTexture(glfx.gl.TEXTURE_2D,e),glfx.gl.uniform1i(r.samplerUniform,0),glfx.gl.bindBuffer(glfx.gl.ARRAY_BUFFER,a.vertexBuffer),glfx.gl.vertexAttribPointer(r.vertexPositionAttribute,a.vertexBuffer.itemSize,glfx.gl.FLOAT,!1,0,0),glfx.gl.bindBuffer(glfx.gl.ARRAY_BUFFER,a.texcoordBuffer),glfx.gl.vertexAttribPointer(r.textureCoordAttribute,a.texcoordBuffer.itemSize,glfx.gl.FLOAT,!1,0,0),glfx.gl.uniformMatrix4fv(r.pMatrixUniform,!1,s),glfx.gl.uniformMatrix4fv(r.mvMatrixUniform,!1,n),glfx.gl.bindBuffer(glfx.gl.ELEMENT_ARRAY_BUFFER,a.indexBuffer),glfx.scene.onPostProcessPreDraw(t),glfx.gl.drawElements(glfx.gl.TRIANGLE_STRIP,a.indexBuffer.numItems,glfx.gl.UNSIGNED_SHORT,0),!0};

  exports.Model = Model;
  exports.glfx = glfx;
  exports.mat4 = mat4;
  exports.vec3 = vec3;

  return exports;

}({}));
//# sourceMappingURL=glfx.min.js.map
